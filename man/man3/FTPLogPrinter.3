.\" ---------------------------------------------------------------------------
.\" Ulm's Oberon System Documentation
.\" Copyright (C) 1989-2001 by University of Ulm, SAI, D-89069 Ulm, Germany
.\" ---------------------------------------------------------------------------
.\"    Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\" 
.\"    Permission is granted to copy and distribute modified versions of
.\" this manual under the conditions for verbatim copying, provided also
.\" that the sections entitled "GNU General Public License" and "Protect
.\" Your Freedom--Fight `Look And Feel'" are included exactly as in the
.\" original, and provided that the entire resulting derived work is
.\" distributed under the terms of a permission notice identical to this
.\" one.
.\" 
.\"    Permission is granted to copy and distribute translations of this
.\" manual into another language, under the above conditions for modified
.\" versions, except that the sections entitled "GNU General Public
.\" License" and "Protect Your Freedom--Fight `Look And Feel'", and this
.\" permission notice, may be included in translations approved by the Free
.\" Software Foundation instead of in the original English.
.\" ---------------------------------------------------------------------------
.de Pg
.nf
.ie t \{\
.	sp 0.3v
.	ps 9
.	ft CW
.\}
.el .sp 1v
..
.de Pe
.ie t \{\
.	ps
.	ft P
.	sp 0.3v
.\}
.el .sp 1v
.fi
..
'\"----------------------------------------------------------------------------
.de Tb
.br
.nr Tw \w'\\$1MMM'
.in +\\n(Twu
..
.de Te
.in -\\n(Twu
..
.de Tp
.br
.ne 2v
.in -\\n(Twu
\fI\\$1\fP
.br
.in +\\n(Twu
.sp -1
..
'\"----------------------------------------------------------------------------
'\" Is [prefix]
'\" Ic capability
'\" If procname params [rtype]
'\" Ef
'\"----------------------------------------------------------------------------
.de Is
.br
.ie \\n(.$=1 .ds iS \\$1
.el .ds iS "
.nr I1 5
.nr I2 5
.in +\\n(I1
..
.de Ic
.sp .3
.in -\\n(I1
.nr I1 5
.nr I2 2
.in +\\n(I1
.ti -\\n(I1
If
\.I \\$1
\.B IN
\.IR caps :
.br
..
.de If
.ne 3v
.sp 0.3
.ti -\\n(I2
.ie \\n(.$=3 \fI\\$1\fP: \fBPROCEDURE\fP(\\*(iS\\$2) : \\$3;
.el \fI\\$1\fP: \fBPROCEDURE\fP(\\*(iS\\$2);
.br
..
.de Ef
.in -\\n(I1
.sp 0.3
..
'\"----------------------------------------------------------------------------
'\"	Strings - made in Ulm (tm 8/87)
'\"
'\"				troff or new nroff
'ds A \(:A
'ds O \(:O
'ds U \(:U
'ds a \(:a
'ds o \(:o
'ds u \(:u
'ds s \(ss
'\"
'\"     international character support
.ds ' \h'\w'e'u*4/10'\z\(aa\h'-\w'e'u*4/10'
.ds ` \h'\w'e'u*4/10'\z\(ga\h'-\w'e'u*4/10'
.ds : \v'-0.6m'\h'(1u-(\\n(.fu%2u))*0.13m+0.06m'\z.\h'0.2m'\z.\h'-((1u-(\\n(.fu%2u))*0.13m+0.26m)'\v'0.6m'
.ds ^ \\k:\h'-\\n(.fu+1u/2u*2u+\\n(.fu-1u*0.13m+0.06m'\z^\h'|\\n:u'
.ds ~ \\k:\h'-\\n(.fu+1u/2u*2u+\\n(.fu-1u*0.13m+0.06m'\z~\h'|\\n:u'
.ds C \\k:\\h'+\\w'e'u/4u'\\v'-0.6m'\\s6v\\s0\\v'0.6m'\\h'|\\n:u'
.ds v \\k:\(ah\\h'|\\n:u'
.ds , \\k:\\h'\\w'c'u*0.4u'\\z,\\h'|\\n:u'
'\"----------------------------------------------------------------------------
.ie t .ds St "\v'.3m'\s+2*\s-2\v'-.3m'
.el .ds St *
.de cC
.IP "\fB\\$1\fP"
..
'\"----------------------------------------------------------------------------
.de Op
.TP
.SM
.ie \\n(.$=2 .BI (+|\-)\\$1 " \\$2"
.el .B (+|\-)\\$1
..
.de Mo
.TP
.SM
.BI \\$1 " \\$2"
..
'\"----------------------------------------------------------------------------
.TH FTPLogPrinter 3 "Last change: 8 May 2001" "Release 0.5" "Ulm's Oberon System"
.SH NAME
FTPLogPrinter \- print FTP log events to an output stream
.SH SYNOPSIS
.Pg
PROCEDURE Install(session: FTPSessions.Session; log: Streams.Stream);
.Pe
.SH DESCRIPTION
.I FTPLogPrinter
provides separate tasks that convert FTP log events into
printed messages onto a designated output stream.
.LP
.I Install
spawns a task (using \fIJobs(3)\fP) that processes log events generated by
\fIFTPLoggers(3)\fP for \fIsession\fP until \fIsession\fP terminates
(see \fIResources(3)\fP) or output operations to \fIlog\fP fail.
The output generated for a log event consists of
.IP \(bu
a line beginning with ``<<< '' presenting the FTP request
(see \fIFTPRequests(3)\fP),
.IP \(bu
a line beginning with ``>>> '' showing the FTP response
(see \fIFTPResponses(3)\fP), and,
.IP \(bu
if any error events occured in the context of this FTP
request, the output generated by \fIConclusions(3)\fP in
the succeeding lines.
.LP
\fIStreams.Flush\fP is invoked for \fIlog\fP after printing each log event.
Hence, \fIStreams.onebuf\fP should be taken as buffering mode for \fIlog\fP.
.LP
Multiple logging tasks with different output streams for
a particular \fIsession\fP are permitted.
.SH "SECURITY CONSIDERATIONS"
Due to the pipelining architecture it is possible that not all
FTP log events are printed if the FTP server process terminates
abnormally.
.LP
When logging fails (due to the termination of an output filter, for
example), FTP server operations for \fIsession\fP continue to be handled
unless provisions are taken that \fIsession\fP terminates as well in
such cases.
.LP
All requests, responses, and error reports depend on the input provided
by the communication partner. Hence, they may contain overly long strings
(e.g., for buffer overrun attacks) or malicious sequences (e.g., for
format attacks) that could exploit external utilities that postprocess logs.
\fIFTPLogPrinter\fP itself provides all data as-is without any filtering
against possible attacks.
.LP
The utility \fIsplogger(8)\fP that is shipped with Qmail
(see \fBhttp://cr.yp.to/qmail.html\fP) may be used in
conjunction with \fIUnixPipes(3)\fP to forward log messages
in a safe way to \fIsyslogd(1m)\fP.
.LP
Another secure output filter is \fImultilog\fP,
see \fBhttp://cr.yp.to/daemontools/multilog.html\fP.
.SH "SEE ALSO"
.Tb FTPLoggers(3)
.Tp FTPLoggers(3)
FTP log events
.Te
.SH BUGS
Please note that responses in their logged form
are not necessarily complete as marks
(intermediate responses, see \fIFTPSessions(3)\fP)
are not propagated to \fIFTPLoggers(3)\fP.
.\" ---------------------------------------------------------------------------
.\" $Id: FTPLogPrinter.3,v 1.2 2001/05/08 08:21:29 borchert Exp $
.\" ---------------------------------------------------------------------------
.\" $Log: FTPLogPrinter.3,v $
.\" Revision 1.2  2001/05/08 08:21:29  borchert
.\" - FTPServers renamed to FTPSessions
.\" - security section extended
.\"
.\" Revision 1.1  2001/05/08 06:31:13  borchert
.\" Initial revision
.\"
.\" ---------------------------------------------------------------------------
